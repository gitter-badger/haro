{"version":3,"sources":["../../src/haro.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;;;;;yBAEK,YAAY;;;;yBACZ,YAAY;;;;uBACe,WAAW;;IAE3C,IAAI;AACJ,UADA,IAAI,CACH,IAAI,EAAE;wBADP,IAAI;;AAEf,MAAI,CAAC,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC;AACtB,MAAI,CAAC,MAAM,GAAG;AACb,SAAM,EAAE,KAAK;AACb,cAAW,EAAE,KAAK;AAClB,UAAO,EAAE;AACR,UAAM,EAAE,kBAAkB;AAC1B,kBAAc,EAAE,kBAAkB;IAClC;GACD,CAAC;AACF,MAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,MAAI,CAAC,GAAG,GAAG,EAAE,CAAC;AACd,MAAI,CAAC,MAAM,GAAG,EAAE,CAAC;AACjB,MAAI,CAAC,KAAK,GAAG,CAAC,CAAC;AACf,MAAI,CAAC,GAAG,GAAG,EAAE,CAAC;AACd,MAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;;AAE1B,MAAI,IAAI,EAAE;AACT,OAAI,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;GACxB;EACD;;cArBW,IAAI;;SAuBV,eAAC,IAAI,EAAE,IAAI,EAAE;;;AAClB,OAAI,KAAK,GAAG,aA1BE,QAAQ,GA0BA,CAAC;AACvB,OAAI,QAAQ,GAAG,EAAE,CAAC;;AAElB,OAAI,IAAI,KAAK,KAAK,EAAE;AACnB,QAAI,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AACjB,aAAQ,CAAC,IAAI,CAAC,MAAK,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;KACjC,CAAC,CAAC;IACH,MAAM;AACN,QAAI,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AACjB,aAAQ,CAAC,IAAI,CAAC,MAAK,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;KACvC,CAAC,CAAC;IACH;;AAED,UAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;AACzC,SAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IACnB,EAAE,UAAU,CAAC,EAAE;AACf,SAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IAChB,CAAC,CAAC;;AAEH,UAAO,KAAK,CAAC,OAAO,CAAC;GACrB;;;SAEK,iBAAG;AACR,OAAI,CAAC,KAAK,GAAG,CAAC,CAAC;AACf,OAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,OAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;AAClB,OAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;;AAEtB,UAAO,IAAI,CAAC;GACZ;;;SAEG,aAAC,GAAG,EAAiB;;;OAAf,KAAK,gCAAG,KAAK;;AACtB,OAAI,KAAK,GAAG,aA1DE,QAAQ,GA0DA,CAAC;;AAEvB,OAAI,IAAI,GAAG,SAAP,IAAI,GAAS;AAChB,QAAI,KAAK,GAAG,OAAK,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;AAEvC,QAAI,KAAK,GAAG,CAAC,CAAC,EAAE;AACf,SAAI,KAAK,KAAK,CAAC,EAAE;AAChB,aAAK,QAAQ,CAAC,KAAK,EAAE,CAAC;MACtB,MAAM,IAAI,KAAK,KAAM,OAAK,QAAQ,CAAC,MAAM,GAAG,CAAC,AAAC,EAAE;AAChD,aAAK,QAAQ,CAAC,GAAG,EAAE,CAAC;MACpB,MAAM;AACN,aAAK,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;MAC/B;;AAED,YAAK,IAAI,UAAO,CAAC,GAAG,CAAC,CAAC;AACtB,YAAK,QAAQ,UAAO,CAAC,GAAG,CAAC,CAAC;AAC1B,OAAE,OAAK,KAAK,CAAC;KACb;;AAED,SAAK,CAAC,OAAO,EAAE,CAAC;IAChB,CAAC;;AAEF,OAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;AACvB,QAAI,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,EAAE;AACvB,SAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,GAAG,EAAE,EAAC,MAAM,EAAE,QAAQ,EAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,CAAC,EAAE;AAClG,WAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;MACxB,CAAC,CAAC;KACH,MAAM;AACN,SAAI,EAAE,CAAC;KACP;IACD,MAAM;AACN,SAAK,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC;IAC5C;;AAED,UAAO,KAAK,CAAC,OAAO,CAAC;GACrB;;;SAEO,mBAAG;AACV,UAAO,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;GAC3B;;;SAEM,gBAAC,EAAE,EAAE;AACX,OAAI,MAAM,GAAG,EAAE,CAAC;;AAEhB,OAAI,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE,GAAG,EAAE;AAClC,QAAI,EAAE,CAAC,aAvGD,KAAK,EAuGE,KAAK,CAAC,EAAE,aAvGf,KAAK,EAuGgB,GAAG,CAAC,CAAC,KAAK,IAAI,EAAE;AAC1C,WAAM,CAAC,IAAI,CAAC,4BAAM,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;KAC/B;IACD,CAAC,CAAC;;AAEH,UAAO,uBAAM,KAAK,yBAAQ,MAAM,CAAC,CAAC;GAClC;;;SAEO,iBAAC,EAAE,EAAE,GAAG,EAAE;AACjB,UAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;GAClC;;;SAEG,aAAC,GAAG,EAAE;AACT,OAAI,MAAM,YAAA,CAAC;;AAEX,OAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;AACvB,UAAM,GAAG,4BAAM,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;IACxC;;AAED,UAAO,MAAM,CAAC;GACd;;;SAEI,gBAAG;AACP,UAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;GACxB;;;SAEK,iBAAwB;OAAvB,KAAK,gCAAG,CAAC;OAAE,MAAM,gCAAG,CAAC;;AAC3B,OAAI,CAAC,GAAG,KAAK,CAAC;AACd,OAAI,GAAG,GAAG,KAAK,GAAG,MAAM,CAAC;AACzB,OAAI,IAAI,GAAG,EAAE,CAAC;AACd,OAAI,CAAC,YAAA,CAAC;;AAEN,OAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,GAAG,EAAE;AACtB,UAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;IACjC;;AAED,MAAG;AACF,KAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;;AAErB,QAAI,CAAC,EAAE;AACN,SAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;KACvB;IACD,QAAQ,EAAE,CAAC,GAAG,GAAG,EAAE;;AAEpB,UAAO,uBAAM,KAAK,yBAAQ,IAAI,CAAC,CAAC;GAChC;;;SAEG,aAAC,EAAE,EAAE;AACR,OAAI,MAAM,GAAG,EAAE,CAAC;;AAEhB,OAAI,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE,GAAG,EAAE;AAClC,UAAM,CAAC,IAAI,CAAC,4BAAM,GAAG,EAAE,EAAE,CAAC,aA1JpB,KAAK,EA0JqB,KAAK,CAAC,EAAE,aA1JlC,KAAK,EA0JmC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACtD,CAAC,CAAC;;AAEH,UAAO,uBAAM,KAAK,yBAAQ,MAAM,CAAC,CAAC;GAClC;;;SAEO,iBAAC,KAAK,EAAe;OAAb,MAAM,gCAAG,EAAE;;AAC1B,OAAI,GAAG,GAAG,aAjKc,KAAK,EAiKb,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;;AAErC,UAAO,4BAAM,KAAK,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;AAC5C,WAAO,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,GAAG,MAAM,GAAG,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;AACpH,SAAI,GAAG,CAAC,MAAM,KAAK,CAAC,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,EAAE;AAC1C,YAAM,4BAAM,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;MAC7B;;AAED,YAAO,4BAAM,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;KAC9B,EAAE,UAAU,CAAC,EAAE;AACf,WAAM,4BAAM,CAAC,CAAC,OAAO,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;KACnC,CAAC,CAAC;IACH,EAAE,UAAU,CAAC,EAAE;AACf,UAAM,4BAAM,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;IAC1B,CAAC,CAAC;GACH;;;SAEG,aAAC,GAAG,EAAE,IAAI,EAAmC;;;OAAjC,KAAK,gCAAG,KAAK;OAAE,QAAQ,gCAAG,KAAK;;AAC9C,OAAI,KAAK,GAAG,aAnLE,QAAQ,GAmLA,CAAC;AACvB,OAAI,MAAM,GAAG,MAAM,CAAC;AACpB,OAAI,IAAI,GAAG,aArLJ,KAAK,EAqLK,GAAG,KAAK,SAAS,GAAG,IAAI,GAAG,GAAG,CAAC,CAAC;AACjD,OAAI,KAAK,GAAG,aAtLL,KAAK,EAsLM,IAAI,CAAC,CAAC;;AAExB,OAAI,IAAI,GAAG,SAAP,IAAI,GAAS;AAChB,QAAI,MAAM,KAAK,MAAM,EAAE;AACtB,OAAE,OAAK,KAAK,CAAC;AACb,YAAK,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACzB,YAAK,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE,CAAC,CAAC;KACnC,MAAM;AACN,YAAK,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,4BAAM,OAAK,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACxD;;AAED,WAAK,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;AAC3B,SAAK,CAAC,OAAO,CAAC,OAAK,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;IAC9B,CAAC;;AAEF,OAAI,IAAI,KAAK,SAAS,IAAI,IAAI,KAAK,IAAI,EAAE;AACxC,QAAI,GAAG,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,aAtMN,IAAI,GAsMQ,IAAI,aAtMhB,IAAI,GAsMkB,CAAC;IACrD,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;AAC/B,UAAM,GAAG,KAAK,CAAC;;AAEf,QAAI,CAAC,QAAQ,EAAE;AACd,UAAK,GAAG,aA3Mc,KAAK,EA2Mb,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;KACxC;IACD;;AAED,OAAI,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,EAAE;AACvB,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,IAAI,EACrD,EAAC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,CAAC,EAAE;AACvE,UAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;KACxB,CAAC,CAAC;IACH,MAAM;AACN,QAAI,EAAE,CAAC;IACP;;AAED,UAAO,KAAK,CAAC,OAAO,CAAC;GACrB;;;SAEM,gBAAC,GAAG,EAAE;;;AACZ,OAAI,KAAK,GAAG,aA5NE,QAAQ,GA4NA,CAAC;;AAEvB,OAAI,CAAC,GAAG,GAAG,GAAG,CAAC;;AAEf,OAAI,IAAI,CAAC,GAAG,EAAE;AACb,QAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,UAAA,GAAG,EAAI;AAClC,SAAI,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;;AAElB,SAAI,OAAK,MAAM,EAAE;AAChB,UAAI;AACH,cAAK,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;AAC3C,YAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACf,CAAC,CAAC;OACH,CAAC,OAAO,CAAC,EAAE;AACX,cAAO,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;OACvB;MACD;;AAED,YAAK,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,OAAO,EAAE;AAC/C,WAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;MACvB,EAAE,UAAU,CAAC,EAAE;AACf,WAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;MAChB,CAAC,CAAC;KACH,EAAE,UAAU,CAAC,EAAE;AACf,UAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;KACxB,CAAC,CAAC;IACH,MAAM;AACN,SAAK,CAAC,OAAO,EAAE,CAAC;IAChB;;AAED,UAAO,KAAK,CAAC,OAAO,CAAC;GACrB;;;SAEM,kBAAG;AACT,UAAO,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;GAC1B;;;QA7PW,IAAI;;;QAAJ,IAAI,GAAJ,IAAI","file":"haro.js","sourcesContent":["'use strict';\n\nimport fetch from 'node-fetch';\nimport tuple from 'tiny-tuple';\nimport { clone, deferred, merge, uuid } from './utility';\n\nexport class Haro {\n\tconstructor (data) {\n\t\tthis.data = new Map();\n\t\tthis.config = {\n\t\t\tmethod: 'get',\n\t\t\tcredentials: false,\n\t\t\theaders: {\n\t\t\t\taccept: 'application/json',\n\t\t\t\t'content-type': 'application/json'\n\t\t\t}\n\t\t};\n\t\tthis.registry = [];\n\t\tthis.key = '';\n\t\tthis.source = '';\n\t\tthis.total = 0;\n\t\tthis.uri = '';\n\t\tthis.versions = new Map();\n\n\t\tif (data) {\n\t\t\tthis.batch(data, 'set');\n\t\t}\n\t}\n\n\tbatch (args, type) {\n\t\tlet defer = deferred();\n\t\tlet promises = [];\n\n\t\tif (type === 'del') {\n\t\t\targs.forEach(i => {\n\t\t\t\tpromises.push(this.del(i, true));\n\t\t\t});\n\t\t} else {\n\t\t\targs.forEach(i => {\n\t\t\t\tpromises.push(this.set(null, i, true));\n\t\t\t});\n\t\t}\n\n\t\tPromise.all(promises).then(function (arg) {\n\t\t\tdefer.resolve(arg);\n\t\t}, function (e) {\n\t\t\tdefer.reject(e);\n\t\t});\n\n\t\treturn defer.promise;\n\t}\n\n\tclear () {\n\t\tthis.total = 0;\n\t\tthis.registry = [];\n\t\tthis.data.clear();\n\t\tthis.versions.clear();\n\n\t\treturn this;\n\t}\n\n\tdel (key, batch = false) {\n\t\tlet defer = deferred();\n\n\t\tlet next = () => {\n\t\t\tlet index = this.registry.indexOf(key);\n\n\t\t\tif (index > -1) {\n\t\t\t\tif (index === 0) {\n\t\t\t\t\tthis.registry.shift();\n\t\t\t\t} else if (index === (this.registry.length - 1)) {\n\t\t\t\t\tthis.registry.pop();\n\t\t\t\t} else {\n\t\t\t\t\tthis.registry.splice(index, 1);\n\t\t\t\t}\n\n\t\t\t\tthis.data.delete(key);\n\t\t\t\tthis.versions.delete(key);\n\t\t\t\t--this.total;\n\t\t\t}\n\n\t\t\tdefer.resolve();\n\t\t};\n\n\t\tif (this.data.has(key)) {\n\t\t\tif (!batch && this.uri) {\n\t\t\t\tthis.request(this.uri.replace(/\\?.*/, '') + '/' + key, {method: 'delete'}).then(next, function (e) {\n\t\t\t\t\tdefer.reject(e[0] || e);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnext();\n\t\t\t}\n\t\t} else {\n\t\t\tdefer.reject(new Error('Record not found'));\n\t\t}\n\n\t\treturn defer.promise;\n\t}\n\n\tentries () {\n\t\treturn this.data.entries();\n\t}\n\n\tfilter (fn) {\n\t\tlet result = [];\n\n\t\tthis.forEach(function (value, key) {\n\t\t\tif (fn(clone(value), clone(key)) === true) {\n\t\t\t\tresult.push(tuple(key, value));\n\t\t\t}\n\t\t});\n\n\t\treturn tuple.apply(tuple, result);\n\t}\n\n\tforEach (fn, ctx) {\n\t\treturn this.data.forEach(fn, ctx);\n\t}\n\n\tget (key) {\n\t\tlet output;\n\n\t\tif (this.data.has(key)) {\n\t\t\toutput = tuple(key, this.data.get(key));\n\t\t}\n\n\t\treturn output;\n\t}\n\n\tkeys () {\n\t\treturn this.data.keys();\n\t}\n\n\tlimit (start = 0, offset = 0) {\n\t\tlet i = start;\n\t\tlet nth = start + offset;\n\t\tlet list = [];\n\t\tlet k;\n\n\t\tif (i < 0 || i >= nth) {\n\t\t\tthrow new Error('Invalid range');\n\t\t}\n\n\t\tdo {\n\t\t\tk = this.registry[i];\n\n\t\t\tif (k) {\n\t\t\t\tlist.push(this.get(k));\n\t\t\t}\n\t\t} while (++i < nth);\n\n\t\treturn tuple.apply(tuple, list);\n\t}\n\n\tmap (fn) {\n\t\tlet result = [];\n\n\t\tthis.forEach(function (value, key) {\n\t\t\tresult.push(tuple(key, fn(clone(value), clone(key))));\n\t\t});\n\n\t\treturn tuple.apply(tuple, result);\n\t}\n\n\trequest (input, config = {}) {\n\t\tlet cfg = merge(this.config, config);\n\n\t\treturn fetch(input, cfg).then(function (res) {\n\t\t\treturn res[res.headers.get('content-type').indexOf('application/json') > -1 ? 'json' : 'text']().then(function (arg) {\n\t\t\t\tif (res.status === 0 || res.status >= 400) {\n\t\t\t\t\tthrow tuple(arg, res.status);\n\t\t\t\t}\n\n\t\t\t\treturn tuple(arg, res.status);\n\t\t\t}, function (e) {\n\t\t\t\tthrow tuple(e.message, res.status);\n\t\t\t});\n\t\t}, function (e) {\n\t\t\tthrow tuple(e.message, 0);\n\t\t});\n\t}\n\n\tset (key, data, batch = false, override = false) {\n\t\tlet defer = deferred();\n\t\tlet method = 'post';\n\t\tlet lkey = clone(key === undefined ? null : key);\n\t\tlet ldata = clone(data);\n\n\t\tlet next = () => {\n\t\t\tif (method === 'post') {\n\t\t\t\t++this.total;\n\t\t\t\tthis.registry.push(lkey);\n\t\t\t\tthis.versions.set(lkey, new Set());\n\t\t\t} else {\n\t\t\t\tthis.versions.get(lkey).add(tuple(this.data.get(lkey)));\n\t\t\t}\n\n\t\t\tthis.data.set(lkey, ldata);\n\t\t\tdefer.resolve(this.get(lkey));\n\t\t};\n\n\t\tif (lkey === undefined || lkey === null) {\n\t\t\tlkey = this.key ? ldata[this.key] : uuid() || uuid();\n\t\t} else if (this.data.has(lkey)) {\n\t\t\tmethod = 'put';\n\n\t\t\tif (!override) {\n\t\t\t\tldata = merge(this.get(lkey)[1], ldata);\n\t\t\t}\n\t\t}\n\n\t\tif (!batch && this.uri) {\n\t\t\tthis.request(this.uri.replace(/\\?.*/, '') + '/' + lkey,\n\t\t\t\t{method: method, body: JSON.stringify(ldata)}).then(next, function (e) {\n\t\t\t\tdefer.reject(e[0] || e);\n\t\t\t});\n\t\t} else {\n\t\t\tnext();\n\t\t}\n\n\t\treturn defer.promise;\n\t}\n\n\tsetUri (uri) {\n\t\tlet defer = deferred();\n\n\t\tthis.uri = uri;\n\n\t\tif (this.uri) {\n\t\t\tthis.request(this.uri).then(arg => {\n\t\t\t\tlet data = arg[0];\n\n\t\t\t\tif (this.source) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.source.split('.').forEach(function (i) {\n\t\t\t\t\t\t\tdata = data[i];\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.batch(data, 'set').then(function (records) {\n\t\t\t\t\tdefer.resolve(records);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(e);\n\t\t\t\t});\n\t\t\t}, function (e) {\n\t\t\t\tdefer.reject(e[0] || e);\n\t\t\t});\n\t\t} else {\n\t\t\tdefer.resolve();\n\t\t}\n\n\t\treturn defer.promise;\n\t}\n\n\tvalues () {\n\t\treturn this.data.values();\n\t}\n}\n"]}